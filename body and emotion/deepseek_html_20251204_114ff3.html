<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body & Emotion Explorer Camp</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Chalkboard SE', cursive;
        }
        
        body {
            background: linear-gradient(135deg, #e0f7fa 0%, #bbdefb 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #1565c0;
            font-size: 2.8rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #5e92f3;
            font-size: 1.4rem;
        }
        
        .dashboard {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .star-counter {
            background: white;
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stars {
            color: gold;
            font-size: 1.8rem;
        }
        
        .modules {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .module-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            border: 4px solid transparent;
        }
        
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .module-card.active {
            border-color: #42a5f5;
        }
        
        .module-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .module-title {
            color: #1565c0;
            font-size: 1.5rem;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .module-desc {
            color: #555;
            line-height: 1.5;
            text-align: center;
        }
        
        .game-area {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
            min-height: 500px;
            margin-bottom: 30px;
        }
        
        .game-title {
            color: #1565c0;
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .emotion-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 25px 0;
        }
        
        .emotion-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            min-width: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .happy { background: #fff9c4; color: #f57f17; }
        .angry { background: #ffcdd2; color: #c62828; }
        .sad { background: #e1f5fe; color: #0277bd; }
        .scared { background: #f3e5f5; color: #6a1b9a; }
        .calm { background: #c8e6c9; color: #2e7d32; }
        .excited { background: #ffecb3; color: #ff8f00; }
        
        .emotion-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .emotion-btn.active {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
        }
        
        .emotion-emoji {
            font-size: 2rem;
        }
        
        .body-canvas-container {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }
        
        #bodyCanvas {
            background: #f9f9f9;
            border-radius: 15px;
            max-width: 100%;
            cursor: pointer;
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .quiz-option {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 1.1rem;
        }
        
        .quiz-option:hover {
            background: #bbdefb;
            transform: scale(1.03);
        }
        
        .quiz-option.correct {
            background: #c8e6c9;
            animation: pulse 0.5s;
        }
        
        .quiz-option.wrong {
            background: #ffcdd2;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .breathing-animation {
            text-align: center;
            margin: 30px 0;
        }
        
        .breath-circle {
            width: 150px;
            height: 150px;
            background: #81d4fa;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            transition: all 4s ease-in-out;
        }
        
        .breath-text {
            font-size: 1.3rem;
            color: #1565c0;
            margin-top: 20px;
        }
        
        .feedback {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .positive-feedback {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .neutral-feedback {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .primary-btn {
            background: #42a5f5;
            color: white;
        }
        
        .primary-btn:hover {
            background: #2196f3;
            transform: scale(1.05);
        }
        
        .secondary-btn {
            background: #ce93d8;
            color: white;
        }
        
        .secondary-btn:hover {
            background: #ba68c8;
            transform: scale(1.05);
        }
        
        .hidden {
            display: none !important;
        }
        
        .sound-btn {
            background: #ffcc80;
            color: #e65100;
            margin: 10px;
            padding: 12px 20px;
            border-radius: 50px;
            cursor: pointer;
            border: none;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .sound-btn:hover {
            background: #ffb74d;
            transform: scale(1.05);
        }
        
        .sound-board {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }
        
        .scenario {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.2rem;
            line-height: 1.6;
        }
        
        .reaction-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .reaction-option {
            background: #e8eaf6;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .reaction-option:hover {
            background: #c5cae9;
            transform: scale(1.02);
        }
        
        .completed {
            position: relative;
        }
        
        .completed::after {
            content: "‚úì";
            position: absolute;
            top: 15px;
            right: 15px;
            background: #4caf50;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .volume-control {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 50px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .volume-slider {
            width: 80px;
        }
        
        .sound-test-btn {
            position: fixed;
            top: 80px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 50px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .emotion-display {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
            background: #f9f9f9;
        }
        
        .emotion-emoji-large {
            font-size: 5rem;
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .emotion-sound-btn {
            margin-top: 15px;
            background: #ffcc80;
            color: #e65100;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .emotion-sound-btn:hover {
            background: #ffb74d;
        }
        
        .emotion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .emotion-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .emotion-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
        
        .emotion-card-emoji {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .emotion-card-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .emotion-card-sound {
            background: #e3f2fd;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .modules {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .game-area {
                padding: 20px;
            }
            
            .volume-control {
                top: 10px;
                right: 10px;
            }
            
            .sound-test-btn {
                top: 70px;
                right: 10px;
            }
            
            .emotion-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Volume Control -->
    <div class="volume-control">
        <span>üîä</span>
        <input type="range" min="0" max="100" value="50" class="volume-slider" id="volumeSlider">
    </div>
    
    <!-- Sound Test Button -->
    <button class="sound-test-btn" id="soundTestBtn">Test Sound üîä</button>
    
    <div class="container">
        <header>
            <h1>Body & Emotion Explorer Camp</h1>
            <p class="subtitle">Learn how your body feels with different emotions!</p>
        </header>
        
        <div class="dashboard">
            <div class="star-counter">
                <span class="stars">‚≠ê‚≠ê‚≠ê</span>
                <span id="starCount">0</span> Emotion Stars
            </div>
        </div>
        
        <div class="modules">
            <div class="module-card" data-module="bodyMap">
                <div class="module-icon">üß≠</div>
                <h3 class="module-title">Emotion Body Map</h3>
                <p class="module-desc">Touch body parts to see how emotions feel in your body</p>
            </div>
            
            <div class="module-card" data-module="bodyQuiz">
                <div class="module-icon">‚ùì</div>
                <h3 class="module-title">Body Response Quiz</h3>
                <p class="module-desc">Test your knowledge about body signals</p>
            </div>
            
            <div class="module-card" data-module="soundQuiz">
                <div class="module-icon">üéµ</div>
                <h3 class="module-title">Emotion Sound Quiz</h3>
                <p class="module-desc">Guess emotions from sounds and body clues</p>
            </div>
            
            <div class="module-card" data-module="calmTools">
                <div class="module-icon">üåø</div>
                <h3 class="module-title">Calming Tools</h3>
                <p class="module-desc">Learn breathing and grounding techniques</p>
            </div>
            
            <div class="module-card" data-module="reactionGame">
                <div class="module-icon">üéÆ</div>
                <h3 class="module-title">Choose Your Reaction</h3>
                <p class="module-desc">Practice responding to emotional situations</p>
            </div>
            
            <div class="module-card" data-module="emotionGallery">
                <div class="module-icon">üòä</div>
                <h3 class="module-title">Emotion Gallery</h3>
                <p class="module-desc">Explore different emotions with sounds and emojis</p>
            </div>
        </div>
        
        <div class="game-area">
            <h2 class="game-title" id="gameTitle">Welcome to Emotion Explorer Camp!</h2>
            <div id="gameContent">
                <p style="text-align: center; font-size: 1.3rem; color: #555; margin-top: 100px;">
                    Select a module from above to start playing! üåà
                </p>
            </div>
            <div class="feedback" id="feedback"></div>
            <div class="controls">
                <button class="primary-btn hidden" id="nextBtn">Next</button>
                <button class="secondary-btn hidden" id="backBtn">Back to Menu</button>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Emotion Data with emojis and sounds
        const emotionData = {
            happy: {
                name: "Happy",
                emoji: "üòä",
                color: '#FFF9C4',
                textColor: '#f57f17',
                areas: ['heart', 'stomach', 'face'],
                description: 'Warm, light, bubbly feeling',
                soundDesc: 'Joyful laughter and giggles',
                bodyClues: ['Smiling face', 'Relaxed shoulders', 'Bouncy movement']
            },
            angry: {
                name: "Angry",
                emoji: "üò†",
                color: '#FFCDD2',
                textColor: '#c62828',
                areas: ['head', 'chest', 'hands'],
                description: 'Hot, tense, pounding feeling',
                soundDesc: 'Growling and stomping sounds',
                bodyClues: ['Clenched fists', 'Hot face', 'Tight jaw']
            },
            sad: {
                name: "Sad",
                emoji: "üò¢",
                color: '#E1F5FE',
                textColor: '#0277bd',
                areas: ['chest', 'throat', 'eyes'],
                description: 'Heavy, empty, slow feeling',
                soundDesc: 'Soft crying and sniffles',
                bodyClues: ['Droopy shoulders', 'Tears', 'Slumped posture']
            },
            scared: {
                name: "Scared",
                emoji: "üò®",
                color: '#F3E5F5',
                textColor: '#6a1b9a',
                areas: ['stomach', 'legs', 'heart'],
                description: 'Shaky, cold, fluttery feeling',
                soundDesc: 'Gasping and shaky breathing',
                bodyClues: ['Wide eyes', 'Shaking hands', 'Fast heartbeat']
            },
            calm: {
                name: "Calm",
                emoji: "üòå",
                color: '#C8E6C9',
                textColor: '#2e7d32',
                areas: ['whole'],
                description: 'Peaceful, steady, relaxed feeling',
                soundDesc: 'Deep, slow breathing',
                bodyClues: ['Soft breathing', 'Relaxed muscles', 'Gentle smile']
            },
            excited: {
                name: "Excited",
                emoji: "ü§©",
                color: '#FFECB3',
                textColor: '#ff8f00',
                areas: ['heart', 'hands', 'feet'],
                description: 'Bouncy, energetic, tingly feeling',
                soundDesc: 'Happy squeals and clapping',
                bodyClues: ['Jumping up and down', 'Fast talking', 'Sparkly eyes']
            },
            surprised: {
                name: "Surprised",
                emoji: "üò≤",
                color: '#E1BEE7',
                textColor: '#7B1FA2',
                areas: ['eyes', 'mouth', 'heart'],
                description: 'Sudden, wide-awake feeling',
                soundDesc: 'Gasp and "Oh!" sounds',
                bodyClues: ['Wide eyes', 'Open mouth', 'Jumping back']
            },
            loved: {
                name: "Loved",
                emoji: "ü•∞",
                color: '#F8BBD0',
                textColor: '#880E4F',
                areas: ['heart', 'chest', 'face'],
                description: 'Warm, soft, glowing feeling',
                soundDesc: 'Content sighs and soft humming',
                bodyClues: ['Warm cheeks', 'Gentle smile', 'Relaxed breathing']
            }
        };

        // Game State
        const gameState = {
            currentModule: null,
            stars: 0,
            completedModules: new Set(),
            audioEnabled: false,
            bodyMap: {
                emotions: emotionData,
                selectedEmotion: null
            },
            quiz: {
                currentQuestion: 0,
                questions: [
                    {
                        question: "When you're nervous, where might you feel butterflies?",
                        options: ["Stomach", "Head", "Feet", "Ears"],
                        correct: 0
                    },
                    {
                        question: "Where do you feel heat when you're angry?",
                        options: ["Chest and face", "Knees", "Elbows", "Back"],
                        correct: 0
                    },
                    {
                        question: "When scared, what might happen to your hands?",
                        options: ["They shake", "They turn green", "They glow", "They get bigger"],
                        correct: 0
                    },
                    {
                        question: "Where do happy feelings often spread in your body?",
                        options: ["All over!", "Just in toes", "Only in nose", "In your hair"],
                        correct: 0
                    }
                ]
            },
            soundQuiz: {
                sounds: [
                    { emotion: 'happy', emoji: 'üòä', bodyClue: 'Big smile and bouncing' },
                    { emotion: 'sad', emoji: 'üò¢', bodyClue: 'Tears and slumped shoulders' },
                    { emotion: 'angry', emoji: 'üò†', bodyClue: 'Hot face and clenched fists' },
                    { emotion: 'scared', emoji: 'üò®', bodyClue: 'Shaking and wide eyes' }
                ],
                currentSound: 0
            },
            scenarios: [
                {
                    situation: "Your friend accidentally breaks your favorite toy.",
                    reactions: [
                        { text: "Yell and push them", outcome: "negative", message: "That might make both of you feel worse. Try taking a deep breath first." },
                        { text: "Take 3 deep breaths, then tell them how you feel", outcome: "positive", message: "Great choice! Breathing helps calm your body before talking." },
                        { text: "Cry and run away", outcome: "neutral", message: "It's okay to feel sad, but talking about it can help too." }
                    ]
                },
                {
                    situation: "You're about to perform on stage and feel butterflies.",
                    reactions: [
                        { text: "Do jumping jacks to use the energy", outcome: "positive", message: "Good idea! Moving can help with nervous energy." },
                        { text: "Hide backstage and skip your turn", outcome: "negative", message: "You can do it! Remember to breathe." },
                        { text: "Imagine the audience is cheering for you", outcome: "positive", message: "Excellent! Positive thinking helps your body feel calmer." }
                    ]
                }
            ],
            currentScenario: 0
        };

        // DOM Elements
        const starCountEl = document.getElementById('starCount');
        const moduleCards = document.querySelectorAll('.module-card');
        const gameTitle = document.getElementById('gameTitle');
        const gameContent = document.getElementById('gameContent');
        const feedback = document.getElementById('feedback');
        const nextBtn = document.getElementById('nextBtn');
        const backBtn = document.getElementById('backBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const soundTestBtn = document.getElementById('soundTestBtn');

        // Audio Context and Sounds
        let audioContext;
        let masterGain;
        let sounds = {};

        // Initialize
        function init() {
            updateStarDisplay();
            setupModuleListeners();
            setupControlListeners();
            setupVolumeControl();
            setupAudio();
            
            // Show audio instructions if not enabled
            if (!gameState.audioEnabled) {
                setTimeout(() => {
                    feedback.textContent = "üîä Click 'Test Sound' button to enable audio!";
                    feedback.className = 'feedback neutral-feedback';
                }, 1000);
            }
        }

        function setupAudio() {
            try {
                // Create Audio Context
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                masterGain = audioContext.createGain();
                masterGain.connect(audioContext.destination);
                masterGain.gain.value = volumeSlider.value / 100;
                
                // Create emotion sounds
                createEmotionSounds();
                gameState.audioEnabled = true;
            } catch (e) {
                console.log("Audio not supported or blocked:", e);
            }
        }

        function createEmotionSounds() {
            // Basic sounds
            sounds.click = createBeep(800, 0.1);
            sounds.correct = createChord([523.25, 659.25, 783.99], 0.5);
            sounds.wrong = createBeep(300, 0.3);
            sounds.star = createAscendingTone([392, 493.88, 587.33, 698.46], 0.8);
            sounds.breathing = createBreathingSound();
            
            // Emotion-specific sounds
            sounds.happy = createHappySound();
            sounds.sad = createSadSound();
            sounds.angry = createAngrySound();
            sounds.scared = createScaredSound();
            sounds.calm = createCalmSound();
            sounds.excited = createExcitedSound();
            sounds.surprised = createSurprisedSound();
            sounds.loved = createLovedSound();
        }

        function createHappySound() {
            return function() {
                if (!audioContext) return;
                
                // Laughing/giggling sound
                const times = [0, 0.2, 0.4, 0.6];
                times.forEach(time => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(masterGain);
                        
                        oscillator.frequency.value = 600 + Math.random() * 200;
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.05);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.2);
                    }, time * 1000);
                });
            };
        }

        function createSadSound() {
            return function() {
                if (!audioContext) return;
                
                // Slow, descending sad sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 1);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1);
            };
        }

        function createAngrySound() {
            return function() {
                if (!audioContext) return;
                
                // Aggressive, tense sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.value = 150;
                oscillator.type = 'sawtooth';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            };
        }

        function createScaredSound() {
            return function() {
                if (!audioContext) return;
                
                // Quick, high-pitched gasp
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.3);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.15, audioContext.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            };
        }

        function createCalmSound() {
            return function() {
                if (!audioContext) return;
                
                // Slow, peaceful waves
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.value = 220;
                oscillator.type = 'sine';
                
                // Gentle wave pattern
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                for (let i = 0; i < 3; i++) {
                    gainNode.gain.linearRampToValueAtTime(0.05, audioContext.currentTime + i * 0.5);
                    gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + i * 0.5 + 0.25);
                }
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1.5);
            };
        }

        function createExcitedSound() {
            return function() {
                if (!audioContext) return;
                
                // Fast, bouncy ascending notes
                const notes = [523.25, 587.33, 659.25, 698.46, 783.99]; // C5, D5, E5, F5, G5
                notes.forEach((note, index) => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(masterGain);
                        
                        oscillator.frequency.value = note;
                        oscillator.type = 'triangle';
                        
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.08, audioContext.currentTime + 0.05);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.2);
                    }, index * 100);
                });
            };
        }

        function createSurprisedSound() {
            return function() {
                if (!audioContext) return;
                
                // Quick burst then silence
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.value = 600;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.15, audioContext.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            };
        }

        function createLovedSound() {
            return function() {
                if (!audioContext) return;
                
                // Soft, warm chord
                const frequencies = [261.63, 329.63, 392.00]; // C4, E4, G4
                frequencies.forEach(freq => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(masterGain);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.04, audioContext.currentTime + 0.5);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 1.5);
                });
            };
        }

        function createBeep(frequency, duration) {
            return function() {
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            };
        }

        function createChord(frequencies, duration) {
            return function() {
                if (!audioContext) return;
                
                frequencies.forEach(freq => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(masterGain);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'triangle';
                    
                    gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration);
                });
            };
        }

        function createAscendingTone(frequencies, duration) {
            return function() {
                if (!audioContext) return;
                
                const noteDuration = duration / frequencies.length;
                
                frequencies.forEach((freq, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(masterGain);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';
                    
                    const startTime = audioContext.currentTime + (index * noteDuration);
                    
                    gainNode.gain.setValueAtTime(0, startTime);
                    gainNode.gain.linearRampToValueAtTime(0.1, startTime + 0.05);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + noteDuration);
                    
                    oscillator.start(startTime);
                    oscillator.stop(startTime + noteDuration);
                });
            };
        }

        function createBreathingSound() {
            return function() {
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGain);
                
                oscillator.frequency.value = 200;
                oscillator.type = 'sine';
                
                // Breathing pattern
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 1);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 4);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 4);
            };
        }

        function playSound(soundName) {
            if (!gameState.audioEnabled || !sounds[soundName]) {
                return;
            }
            
            try {
                sounds[soundName]();
            } catch (e) {
                console.log("Sound play failed:", e);
            }
        }

        function testAudio() {
            if (!gameState.audioEnabled) {
                setupAudio();
            }
            
            if (gameState.audioEnabled) {
                playSound('correct');
                feedback.textContent = "‚úÖ Sound is working! Try emotion sounds in Emotion Gallery!";
                feedback.className = 'feedback positive-feedback';
                setTimeout(() => {
                    if (gameState.currentModule) showFeedback('');
                }, 3000);
            }
        }

        function setupVolumeControl() {
            volumeSlider.addEventListener('input', function() {
                const volume = this.value / 100;
                if (masterGain) {
                    masterGain.gain.value = volume;
                }
            });
            
            soundTestBtn.addEventListener('click', () => {
                playSound('click');
                testAudio();
            });
        }

        function updateStarDisplay() {
            starCountEl.textContent = gameState.stars;
        }

        function addStars(count) {
            gameState.stars += count;
            updateStarDisplay();
            
            // Visual and audio feedback
            feedback.textContent = `+${count} ‚≠ê Earned!`;
            feedback.className = 'feedback positive-feedback';
            playSound('star');
            
            setTimeout(() => {
                if (gameState.currentModule) {
                    showFeedback('');
                }
            }, 2000);
        }

        function markModuleCompleted(module) {
            gameState.completedModules.add(module);
            const card = document.querySelector(`[data-module="${module}"]`);
            if (card) {
                card.classList.add('completed');
            }
        }

        function setupModuleListeners() {
            moduleCards.forEach(card => {
                card.addEventListener('click', () => {
                    playSound('click');
                    const module = card.dataset.module;
                    loadModule(module);
                    
                    // Update active state
                    moduleCards.forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                });
            });
        }

        function setupControlListeners() {
            nextBtn.addEventListener('click', () => {
                playSound('click');
                handleNext();
            });
            backBtn.addEventListener('click', () => {
                playSound('click');
                loadModule(null);
            });
        }

        function loadModule(module) {
            gameState.currentModule = module;
            gameContent.innerHTML = '';
            feedback.innerHTML = '';
            feedback.className = 'feedback';
            nextBtn.classList.add('hidden');
            backBtn.classList.remove('hidden');
            
            if (!module) {
                showMainMenu();
                return;
            }
            
            switch(module) {
                case 'bodyMap':
                    loadBodyMap();
                    break;
                case 'bodyQuiz':
                    loadBodyQuiz();
                    break;
                case 'soundQuiz':
                    loadSoundQuiz();
                    break;
                case 'calmTools':
                    loadCalmTools();
                    break;
                case 'reactionGame':
                    loadReactionGame();
                    break;
                case 'emotionGallery':
                    loadEmotionGallery();
                    break;
            }
            
            markModuleCompleted(module);
        }

        function showMainMenu() {
            gameTitle.textContent = 'Welcome to Emotion Explorer Camp!';
            gameContent.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 5rem; margin-bottom: 20px;">üåà</div>
                    <p style="font-size: 1.5rem; color: #555; margin-bottom: 30px;">
                        Choose a module to learn about emotions and your body!
                    </p>
                    <div style="display: inline-block; background: #E3F2FD; padding: 20px; border-radius: 15px; max-width: 600px;">
                        <h3 style="color: #1565C0; margin-bottom: 15px;">Today's Mission:</h3>
                        <p style="color: #555; line-height: 1.6;">
                            Explore all 6 modules and collect 15 stars!<br>
                            Remember: All feelings are okay. It's what we do with them that matters.
                        </p>
                    </div>
                </div>
            `;
            backBtn.classList.add('hidden');
        }

        // Module 1: Emotion Body Map (Enhanced with emojis)
        function loadBodyMap() {
            gameTitle.textContent = 'Emotion Body Map';
            gameContent.innerHTML = `
                <div style="max-width: 800px; margin: 0 auto;">
                    <div class="emotion-display">
                        <div class="emotion-emoji-large" id="selectedEmotionEmoji">üòä</div>
                        <h3 id="selectedEmotionName" style="color: #1565C0;">Select an Emotion</h3>
                        <p id="selectedEmotionDesc" style="color: #555; font-size: 1.1rem;">Click on an emotion button below</p>
                        <button class="emotion-sound-btn" id="playEmotionSoundBtn">üîä Play Emotion Sound</button>
                    </div>
                    
                    <p style="text-align: center; font-size: 1.2rem; color: #555; margin-bottom: 20px;">
                        Select an emotion, then click on body parts to see how they feel!
                    </p>
                    
                    <div class="emotion-buttons" id="emotionButtons"></div>
                    
                    <div class="body-canvas-container">
                        <canvas id="bodyCanvas" width="600" height="800"></canvas>
                    </div>
                </div>
            `;
            
            // Create emotion buttons with emojis
            const buttonsContainer = document.getElementById('emotionButtons');
            for (const [emotion, data] of Object.entries(gameState.bodyMap.emotions)) {
                const btn = document.createElement('button');
                btn.className = `emotion-btn ${emotion}`;
                btn.innerHTML = `
                    <span class="emotion-emoji">${data.emoji}</span>
                    <span>${data.name}</span>
                `;
                btn.addEventListener('click', () => {
                    playSound('click');
                    selectEmotion(emotion);
                });
                buttonsContainer.appendChild(btn);
            }
            
            // Add sound button listener
            document.getElementById('playEmotionSoundBtn').addEventListener('click', () => {
                playSound('click');
                if (gameState.bodyMap.selectedEmotion) {
                    playSound(gameState.bodyMap.selectedEmotion);
                }
            });
            
            // Initialize canvas
            setTimeout(initBodyCanvas, 100);
        }

        function selectEmotion(emotion) {
            gameState.bodyMap.selectedEmotion = emotion;
            const data = gameState.bodyMap.emotions[emotion];
            
            // Update button states
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.querySelector('span:last-child').textContent === data.name) {
                    btn.classList.add('active');
                }
            });
            
            // Update emotion display
            document.getElementById('selectedEmotionEmoji').textContent = data.emoji;
            document.getElementById('selectedEmotionName').textContent = data.name;
            document.getElementById('selectedEmotionName').style.color = data.textColor;
            document.getElementById('selectedEmotionDesc').textContent = data.description;
            
            // Play the emotion sound
            playSound(emotion);
            
            // Add stars for interaction
            addStars(1);
        }

        function initBodyCanvas() {
            const canvas = document.getElementById('bodyCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Body parts data
            const bodyParts = {
                head: { x: 300, y: 100, radius: 50 },
                chest: { x: 300, y: 220, width: 180, height: 120 },
                stomach: { x: 300, y: 360, width: 160, height: 100 },
                heart: { x: 300, y: 250, radius: 30 },
                hands: { x: 180, y: 300, radius: 40 },
                feet: { x: 250, y: 600, width: 80, height: 120 },
                legs: { x: 300, y: 500, width: 100, height: 200 },
                face: { x: 300, y: 120, radius: 40 },
                throat: { x: 300, y: 180, radius: 20 }
            };
            
            function drawBody() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw body outline
                ctx.fillStyle = '#FFE0B2';
                ctx.strokeStyle = '#5D4037';
                ctx.lineWidth = 3;
                
                // Head
                ctx.beginPath();
                ctx.arc(bodyParts.head.x, bodyParts.head.y, bodyParts.head.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
                
                // Body
                ctx.beginPath();
                ctx.rect(bodyParts.chest.x - bodyParts.chest.width/2, bodyParts.chest.y, 
                        bodyParts.chest.width, bodyParts.chest.height);
                ctx.fill();
                ctx.stroke();
                
                ctx.beginPath();
                ctx.rect(bodyParts.stomach.x - bodyParts.stomach.width/2, bodyParts.stomach.y,
                        bodyParts.stomach.width, bodyParts.stomach.height);
                ctx.fill();
                ctx.stroke();
                
                // Arms
                ctx.beginPath();
                ctx.moveTo(bodyParts.chest.x - bodyParts.chest.width/2, bodyParts.chest.y + 40);
                ctx.lineTo(100, 400);
                ctx.lineWidth = 40;
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(bodyParts.chest.x + bodyParts.chest.width/2, bodyParts.chest.y + 40);
                ctx.lineTo(500, 400);
                ctx.lineWidth = 40;
                ctx.stroke();
                
                // Legs
                ctx.beginPath();
                ctx.moveTo(bodyParts.stomach.x - 30, bodyParts.stomach.y + bodyParts.stomach.height);
                ctx.lineTo(250, 700);
                ctx.lineWidth = 50;
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(bodyParts.stomach.x + 30, bodyParts.stomach.y + bodyParts.stomach.height);
                ctx.lineTo(350, 700);
                ctx.lineWidth = 50;
                ctx.stroke();
                
                // Draw heart
                ctx.fillStyle = '#FF6B6B';
                ctx.beginPath();
                ctx.arc(bodyParts.heart.x, bodyParts.heart.y, bodyParts.heart.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw face features
                ctx.fillStyle = '#5D4037';
                ctx.beginPath();
                ctx.arc(bodyParts.face.x - 15, bodyParts.face.y, 8, 0, Math.PI * 2);
                ctx.arc(bodyParts.face.x + 15, bodyParts.face.y, 8, 0, Math.PI * 2);
                ctx.fill();
                
                // Smile
                ctx.beginPath();
                ctx.arc(bodyParts.face.x, bodyParts.face.y + 10, 20, 0, Math.PI);
                ctx.stroke();
                
                // Add click interaction
                canvas.addEventListener('click', (e) => {
                    playSound('click');
                    handleBodyClick(e, bodyParts, ctx);
                });
            }
            
            drawBody();
        }

        function handleBodyClick(e, bodyParts, ctx) {
            if (!gameState.bodyMap.selectedEmotion) {
                showFeedback('Please select an emotion first!');
                return;
            }
            
            const rect = e.target.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const scaleX = 600 / rect.width;
            const scaleY = 800 / rect.height;
            const scaledX = x * scaleX;
            const scaledY = y * scaleY;
            
            let clickedPart = null;
            for (const [part, data] of Object.entries(bodyParts)) {
                if ('radius' in data) {
                    const dist = Math.sqrt((scaledX - data.x) ** 2 + (scaledY - data.y) ** 2);
                    if (dist <= data.radius) {
                        clickedPart = part;
                        break;
                    }
                } else if ('width' in data) {
                    const inRect = scaledX >= data.x - data.width/2 && 
                                  scaledX <= data.x + data.width/2 &&
                                  scaledY >= data.y && 
                                  scaledY <= data.y + data.height;
                    if (inRect) {
                        clickedPart = part;
                        break;
                    }
                }
            }
            
            if (clickedPart) {
                const emotion = gameState.bodyMap.selectedEmotion;
                const emotionData = gameState.bodyMap.emotions[emotion];
                
                if (emotionData.areas.includes('whole') || emotionData.areas.includes(clickedPart)) {
                    // Visual feedback
                    ctx.fillStyle = emotionData.color + 'AA';
                    if (bodyParts[clickedPart].radius) {
                        ctx.beginPath();
                        ctx.arc(bodyParts[clickedPart].x, bodyParts[clickedPart].y, 
                                bodyParts[clickedPart].radius * 1.5, 0, Math.PI * 2);
                        ctx.fill();
                    } else {
                        ctx.fillRect(
                            bodyParts[clickedPart].x - bodyParts[clickedPart].width/2 - 10,
                            bodyParts[clickedPart].y - 10,
                            bodyParts[clickedPart].width + 20,
                            bodyParts[clickedPart].height + 20
                        );
                    }
                    
                    showFeedback(`Good! When feeling ${emotionData.name.toLowerCase()}, your ${clickedPart} feels it!`);
                    playSound('correct');
                    addStars(2);
                    
                    // Play emotion sound again
                    playSound(emotion);
                    
                    // Redraw body after 1 second
                    setTimeout(() => {
                        const canvas = document.getElementById('bodyCanvas');
                        if (canvas) {
                            const ctx = canvas.getContext('2d');
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            initBodyCanvas();
                        }
                    }, 1000);
                } else {
                    showFeedback(`Interesting! When ${emotionData.name.toLowerCase()}, your ${clickedPart} might not feel as affected.`);
                    playSound('wrong');
                }
            }
        }

        // Module 2: Body Response Quiz
        function loadBodyQuiz() {
            gameState.quiz.currentQuestion = 0;
            showQuizQuestion();
        }

        function showQuizQuestion() {
            const question = gameState.quiz.questions[gameState.quiz.currentQuestion];
            
            gameTitle.textContent = `Body Response Quiz - Question ${gameState.quiz.currentQuestion + 1}`;
            gameContent.innerHTML = `
                <div style="max-width: 600px; margin: 0 auto;">
                    <div style="background: #E3F2FD; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                        <h3 style="color: #1565C0; margin-bottom: 15px; font-size: 1.5rem;">${question.question}</h3>
                    </div>
                    
                    <div class="quiz-options" id="quizOptions"></div>
                </div>
            `;
            
            const optionsContainer = document.getElementById('quizOptions');
            question.options.forEach((option, index) => {
                const optionEl = document.createElement('div');
                optionEl.className = 'quiz-option';
                optionEl.textContent = option;
                optionEl.addEventListener('click', () => {
                    playSound('click');
                    checkAnswer(index);
                });
                optionsContainer.appendChild(optionEl);
            });
            
            nextBtn.classList.add('hidden');
        }

        function checkAnswer(selectedIndex) {
            const question = gameState.quiz.questions[gameState.quiz.currentQuestion];
            const options = document.querySelectorAll('.quiz-option');
            
            options.forEach((opt, index) => {
                opt.style.pointerEvents = 'none';
                if (index === question.correct) {
                    opt.classList.add('correct');
                } else if (index === selectedIndex && index !== question.correct) {
                    opt.classList.add('wrong');
                }
            });
            
            if (selectedIndex === question.correct) {
                showFeedback('Correct! üéâ You understand body signals well!');
                playSound('correct');
                addStars(3);
            } else {
                showFeedback(`Good try! The correct answer is: ${question.options[question.correct]}`);
                playSound('wrong');
            }
            
            nextBtn.classList.remove('hidden');
        }

        // Module 3: Emotion Sound Quiz
        function loadSoundQuiz() {
            gameState.soundQuiz.currentSound = 0;
            showSoundQuestion();
        }

        function showSoundQuestion() {
            const sound = gameState.soundQuiz.sounds[gameState.soundQuiz.currentSound];
            const emotionData = gameState.bodyMap.emotions[sound.emotion];
            
            gameTitle.textContent = 'Emotion Sound Quiz';
            gameContent.innerHTML = `
                <div style="max-width: 600px; margin: 0 auto; text-align: center;">
                    <div style="background: #FFF3E0; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">${emotionData.emoji}</div>
                        <h3 style="color: #EF6C00; margin-bottom: 15px;">Body Clue:</h3>
                        <p style="font-size: 1.3rem; color: #555;">"${sound.bodyClue}"</p>
                    </div>
                    
                    <p style="font-size: 1.2rem; color: #555; margin-bottom: 20px;">
                        What emotion do you think this is?
                    </p>
                    
                    <div class="sound-board" id="soundBoard"></div>
                    
                    <div style="margin-top: 30px;">
                        <button class="primary-btn" id="playSoundBtn">
                            üîä Play Emotion Sound
                        </button>
                    </div>
                </div>
            `;
            
            // Create sound buttons with emojis
            const soundBoard = document.getElementById('soundBoard');
            ['happy', 'sad', 'angry', 'scared'].forEach(emotion => {
                const data = gameState.bodyMap.emotions[emotion];
                const btn = document.createElement('button');
                btn.className = 'sound-btn';
                btn.innerHTML = `${data.emoji} ${data.name}`;
                btn.addEventListener('click', () => {
                    playSound('click');
                    guessSound(emotion);
                });
                soundBoard.appendChild(btn);
            });
            
            // Add event listener for sound button
            const playSoundBtn = document.getElementById('playSoundBtn');
            if (playSoundBtn) {
                playSoundBtn.addEventListener('click', () => {
                    playSound('click');
                    playSound(sound.emotion);
                    showFeedback(`Playing ${sound.emotion} sound...`);
                });
            }
            
            nextBtn.classList.add('hidden');
        }

        function guessSound(emotion) {
            const sound = gameState.soundQuiz.sounds[gameState.soundQuiz.currentSound];
            const emotionData = gameState.bodyMap.emotions[emotion];
            
            if (emotion === sound.emotion) {
                showFeedback(`Correct! üéâ That's ${emotionData.name}! You're good at reading body clues!`);
                playSound('correct');
                playSound(emotion); // Play the emotion sound
                addStars(3);
            } else {
                const correctData = gameState.bodyMap.emotions[sound.emotion];
                showFeedback(`Good try! This body clue shows ${correctData.name}.`);
                playSound('wrong');
            }
            
            nextBtn.classList.remove('hidden');
        }

        // Module 4: Calming Tools
        function loadCalmTools() {
            gameTitle.textContent = 'Calming Tools';
            gameContent.innerHTML = `
                <div style="max-width: 800px; margin: 0 auto;">
                    <div style="background: #E8F5E9; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                        <h3 style="color: #2E7D32; margin-bottom: 15px; font-size: 1.5rem;">When emotions feel big, try these tools:</h3>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
                        <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h4 style="color: #1565C0; margin-bottom: 15px;">üå¨Ô∏è Flower Breathing</h4>
                            <p style="color: #555; margin-bottom: 20px;">Pretend you're smelling a flower, then blowing dandelion seeds.</p>
                            <button class="primary-btn" id="startBreathingBtn">Start Breathing</button>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h4 style="color: #1565C0; margin-bottom: 15px;">üë£ Grounding Game: 5-4-3-2-1</h4>
                            <p style="color: #555; margin-bottom: 20px;">Find: 5 things you see, 4 things you feel, 3 things you hear, 2 things you smell, 1 thing you taste.</p>
                            <button class="primary-btn" id="startGroundingBtn">Start Game</button>
                        </div>
                    </div>
                    
                    <div id="exerciseArea"></div>
                </div>
            `;
            
            // Add event listeners immediately
            const breathingBtn = document.getElementById('startBreathingBtn');
            const groundingBtn = document.getElementById('startGroundingBtn');
            
            if (breathingBtn) {
                breathingBtn.onclick = () => {
                    playSound('click');
                    startBreathingExercise();
                };
            }
            
            if (groundingBtn) {
                groundingBtn.onclick = () => {
                    playSound('click');
                    startGroundingGame();
                };
            }
        }

        function startBreathingExercise() {
            gameContent.querySelector('#exerciseArea').innerHTML = `
                <div class="breathing-animation">
                    <div class="breath-circle" id="breathCircle">Breathe In</div>
                    <div class="breath-text" id="breathText">Smell the flower... üå∏</div>
                    <div style="margin-top: 30px;">
                        <button class="secondary-btn" id="backToToolsBtn">Back to Tools</button>
                    </div>
                </div>
            `;
            
            // Add back button listener
            const backBtn = document.getElementById('backToToolsBtn');
            if (backBtn) {
                backBtn.onclick = () => {
                    playSound('click');
                    loadCalmTools();
                };
            }
            
            const circle = document.getElementById('breathCircle');
            const text = document.getElementById('breathText');
            let cycle = 0;
            const maxCycles = 3;
            
            function breathingCycle() {
                // Breathe in
                playSound('breathing');
                circle.textContent = 'Breathe In';
                circle.style.transform = 'scale(1.5)';
                circle.style.backgroundColor = '#81d4fa';
                text.textContent = 'Smell the flower... üå∏';
                
                setTimeout(() => {
                    // Hold
                    circle.textContent = 'Hold';
                    text.textContent = 'Feel the calm... ‚òÅÔ∏è';
                    
                    setTimeout(() => {
                        // Breathe out
                        playSound('breathing');
                        circle.textContent = 'Breathe Out';
                        circle.style.transform = 'scale(1)';
                        circle.style.backgroundColor = '#4fc3f7';
                        text.textContent = 'Blow the dandelion... üå¨Ô∏è';
                        
                        setTimeout(() => {
                            cycle++;
                            if (cycle < maxCycles) {
                                breathingCycle();
                            } else {
                                text.textContent = 'Great job! Your body feels calmer now! üéâ';
                                playSound('calm');
                                addStars(2);
                            }
                        }, 4000);
                    }, 2000);
                }, 4000);
            }
            
            breathingCycle();
        }

        function startGroundingGame() {
            const exerciseArea = gameContent.querySelector('#exerciseArea');
            if (!exerciseArea) return;
            
            let step = 0;
            const steps = [
                { sense: 'see', number: 5, emoji: 'üëÄ', prompt: 'Look around and name 5 things you can see.' },
                { sense: 'feel', number: 4, emoji: '‚úã', prompt: 'Notice 4 things you can feel (like your clothes or chair).' },
                { sense: 'hear', number: 3, emoji: 'üëÇ', prompt: 'Listen for 3 sounds you can hear.' },
                { sense: 'smell', number: 2, emoji: 'üëÉ', prompt: 'Find 2 things you can smell or like to smell.' },
                { sense: 'taste', number: 1, emoji: 'üëÖ', prompt: 'Name 1 thing you can taste or like to taste.' }
            ];
            
            function updateGroundingStep() {
                exerciseArea.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: #FFF3E0; border-radius: 15px;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">${steps[step].emoji}</div>
                        <h3 style="color: #EF6C00; margin-bottom: 15px;">Step ${step + 1}/5: ${steps[step].sense.toUpperCase()}</h3>
                        <p style="font-size: 1.3rem; color: #555; margin-bottom: 30px;">${steps[step].prompt}</p>
                        
                        <div style="display: flex; justify-content: center; gap: 20px;">
                            <button class="primary-btn" id="nextStepBtn">I did it! Next</button>
                            <button class="secondary-btn" id="backFromGroundingBtn">Back to Tools</button>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <div style="display: flex; justify-content: center; gap: 10px;">
                                ${steps.map((_, i) => `
                                    <div style="width: 20px; height: 20px; border-radius: 50%; background: ${i <= step ? '#4CAF50' : '#E0E0E0'};"></div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                const nextBtn = document.getElementById('nextStepBtn');
                const backBtn = document.getElementById('backFromGroundingBtn');
                
                if (nextBtn) {
                    nextBtn.onclick = () => {
                        playSound('click');
                        step++;
                        if (step < steps.length) {
                            updateGroundingStep();
                        } else {
                            exerciseArea.innerHTML = `
                                <div style="text-align: center; padding: 40px; background: #E8F5E9; border-radius: 15px;">
                                    <div style="font-size: 5rem; margin-bottom: 20px;">üéâ</div>
                                    <h3 style="color: #2E7D32; margin-bottom: 15px;">Excellent Job!</h3>
                                    <p style="font-size: 1.3rem; color: #555; margin-bottom: 20px;">
                                        You completed the grounding exercise! Your body and mind feel more connected now.
                                    </p>
                                    <button class="primary-btn" id="backToToolsFinalBtn">Back to Tools</button>
                                </div>
                            `;
                            playSound('calm');
                            addStars(3);
                            
                            const finalBtn = document.getElementById('backToToolsFinalBtn');
                            if (finalBtn) {
                                finalBtn.onclick = () => {
                                    playSound('click');
                                    loadCalmTools();
                                };
                            }
                        }
                    };
                }
                
                if (backBtn) {
                    backBtn.onclick = () => {
                        playSound('click');
                        loadCalmTools();
                    };
                }
            }
            
            updateGroundingStep();
        }

        // Module 5: Reaction Game
        function loadReactionGame() {
            gameState.currentScenario = 0;
            showScenario();
        }

        function showScenario() {
            const scenario = gameState.scenarios[gameState.currentScenario];
            
            gameTitle.textContent = 'Choose Your Reaction';
            gameContent.innerHTML = `
                <div style="max-width: 700px; margin: 0 auto;">
                    <div class="scenario">
                        <h3 style="color: #5D4037; margin-bottom: 15px;">Situation:</h3>
                        <p style="font-size: 1.3rem; color: #333;">"${scenario.situation}"</p>
                    </div>
                    
                    <h3 style="color: #1565C0; margin-bottom: 20px; text-align: center;">What would you do?</h3>
                    
                    <div class="reaction-options" id="reactionOptions"></div>
                </div>
            `;
            
            const optionsContainer = document.getElementById('reactionOptions');
            scenario.reactions.forEach((reaction, index) => {
                const optionEl = document.createElement('div');
                optionEl.className = 'reaction-option';
                optionEl.innerHTML = `
                    <h4 style="color: #5D4037; margin-bottom: 10px;">Option ${index + 1}</h4>
                    <p style="color: #555;">${reaction.text}</p>
                `;
                optionEl.addEventListener('click', () => {
                    playSound('click');
                    chooseReaction(index);
                });
                optionsContainer.appendChild(optionEl);
            });
            
            nextBtn.classList.add('hidden');
        }

        function chooseReaction(choiceIndex) {
            const scenario = gameState.scenarios[gameState.currentScenario];
            const reaction = scenario.reactions[choiceIndex];
            
            showFeedback(reaction.message);
            
            if (reaction.outcome === 'positive') {
                playSound('correct');
                addStars(3);
            } else if (reaction.outcome === 'neutral') {
                playSound('click');
                addStars(1);
            } else {
                playSound('wrong');
            }
            
            nextBtn.classList.remove('hidden');
        }

        // Module 6: Emotion Gallery (NEW MODULE)
        function loadEmotionGallery() {
            gameTitle.textContent = 'Emotion Gallery';
            gameContent.innerHTML = `
                <div style="max-width: 800px; margin: 0 auto;">
                    <div style="background: #FFF3E0; padding: 25px; border-radius: 15px; margin-bottom: 30px; text-align: center;">
                        <h3 style="color: #EF6C00; margin-bottom: 15px;">Explore Different Emotions</h3>
                        <p style="color: #555; font-size: 1.2rem;">
                            Click on an emotion card to learn about it, or click the sound button to hear how it sounds!
                        </p>
                    </div>
                    
                    <div class="emotion-grid" id="emotionGrid"></div>
                    
                    <div id="selectedEmotionInfo" style="margin-top: 40px;"></div>
                </div>
            `;
            
            // Create emotion grid
            const emotionGrid = document.getElementById('emotionGrid');
            Object.entries(gameState.bodyMap.emotions).forEach(([emotion, data]) => {
                const card = document.createElement('div');
                card.className = 'emotion-card';
                card.style.borderLeft = `5px solid ${data.color}`;
                card.innerHTML = `
                    <div class="emotion-card-emoji">${data.emoji}</div>
                    <div class="emotion-card-name" style="color: ${data.textColor}">${data.name}</div>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px; min-height: 40px;">${data.description}</p>
                    <button class="emotion-card-sound" data-emotion="${emotion}">üîä Play Sound</button>
                `;
                
                // Add click listener to card
                card.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('emotion-card-sound')) {
                        playSound('click');
                        showEmotionInfo(emotion);
                    }
                });
                
                // Add sound button listener
                const soundBtn = card.querySelector('.emotion-card-sound');
                soundBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    playSound('click');
                    playSound(emotion);
                    showFeedback(`Playing ${data.name} sound...`);
                });
                
                emotionGrid.appendChild(card);
            });
        }

        function showEmotionInfo(emotion) {
            const data = gameState.bodyMap.emotions[emotion];
            const infoDiv = document.getElementById('selectedEmotionInfo');
            
            infoDiv.innerHTML = `
                <div style="background: ${data.color + '40'}; padding: 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 4rem; margin-bottom: 15px;">${data.emoji}</div>
                    <h3 style="color: ${data.textColor}; margin-bottom: 15px; font-size: 2rem;">${data.name}</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 25px;">
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <h4 style="color: #1565C0; margin-bottom: 10px;">üéØ Body Feelings</h4>
                            <p style="color: #555;">${data.description}</p>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <h4 style="color: #1565C0; margin-bottom: 10px;">üîä Sound</h4>
                            <p style="color: #555;">${data.soundDesc}</p>
                            <button class="emotion-sound-btn" style="margin-top: 10px;" id="playSelectedSound">
                                Play ${data.name} Sound
                            </button>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 10px; margin-top: 20px;">
                        <h4 style="color: #1565C0; margin-bottom: 10px;">üëÄ Body Clues</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                            ${data.bodyClues.map(clue => `
                                <span style="background: #E3F2FD; padding: 8px 15px; border-radius: 20px; font-size: 0.9rem;">${clue}</span>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="primary-btn" onclick="playSound('${emotion}')">
                            üîÑ Play Sound Again
                        </button>
                    </div>
                </div>
            `;
            
            // Add sound button listener
            document.getElementById('playSelectedSound').addEventListener('click', () => {
                playSound('click');
                playSound(emotion);
            });
            
            // Play the emotion sound
            playSound(emotion);
            
            // Add stars for exploring
            addStars(1);
        }

        // Navigation
        function handleNext() {
            if (gameState.currentModule === 'bodyQuiz') {
                gameState.quiz.currentQuestion++;
                if (gameState.quiz.currentQuestion < gameState.quiz.questions.length) {
                    showQuizQuestion();
                } else {
                    showFeedback('Quiz completed! You earned bonus stars! üéâ');
                    playSound('correct');
                    addStars(5);
                    setTimeout(() => loadModule('bodyQuiz'), 2000);
                }
            } else if (gameState.currentModule === 'soundQuiz') {
                gameState.soundQuiz.currentSound++;
                if (gameState.soundQuiz.currentSound < gameState.soundQuiz.sounds.length) {
                    showSoundQuestion();
                } else {
                    showFeedback('Sound quiz completed! Great listening skills! üëÇ');
                    playSound('correct');
                    addStars(5);
                    setTimeout(() => loadModule('soundQuiz'), 2000);
                }
            } else if (gameState.currentModule === 'reactionGame') {
                gameState.currentScenario++;
                if (gameState.currentScenario < gameState.scenarios.length) {
                    showScenario();
                } else {
                    showFeedback('All scenarios completed! You\'re an emotion expert! üåü');
                    playSound('correct');
                    addStars(5);
                    setTimeout(() => loadModule('reactionGame'), 2000);
                }
            }
            
            nextBtn.classList.add('hidden');
        }

        function showFeedback(message) {
            feedback.textContent = message;
            feedback.className = 'feedback';
            
            if (message.includes('Correct') || message.includes('Great') || message.includes('Excellent')) {
                feedback.classList.add('positive-feedback');
            } else if (message.includes('try') || message.includes('Interesting')) {
                feedback.classList.add('neutral-feedback');
            }
        }

        // Start the game
        init();
        showMainMenu();
    </script>
</body>
</html>